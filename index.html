<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>City Time Converter</title>
    <style>
        body {
            display: flex;
            flex-direction: column;
            align-items: center;
            margin: 0;
            font-family: Arial, sans-serif;
        }
        h1 {
            margin-top: 20px;
        }
        label, input, button {
            margin: 10px;
        }
        #output {
            margin-top: 20px;
            font-size: 1.2em;
            color: #333;
        }
        #output.error {
            color: red;
        }
    </style>
</head>
<body>

    <h1>City Time Converter</h1>
    
    <label for="cityFrom">Current Time Zone:</label>
    <input list="timezones" id="cityFrom" placeholder="Type city name...">
    <datalist id="timezones"></datalist>
    
    <label for="timeAtCity">Time at Your Time Zone (HH:MM, 24hr format):</label>
    <input type="time" id="timeAtCity">
    
    <label for="cityTo">Target Time Zone:</label>
    <input list="timezonesTo" id="cityTo" placeholder="Type target city name...">
    <datalist id="timezonesTo"></datalist>

    <button onclick="calculateTime()">Get Time</button>

    <div id="output"></div>

    <script>
        const timeZoneNames = [
            'America/New_York',
            'America/Los_Angeles',
            'America/Chicago',
            'America/Denver',
            'America/Anchorage',
            'Pacific/Honolulu',
            'America/Sao_Paulo',
            'Europe/London',
            'Europe/Berlin',
            'Asia/Tokyo',
            'Asia/Shanghai',
            'Asia/Bangkok',
            'Asia/Kolkata',
            'Australia/Sydney',
            'Africa/Cairo',
            'Africa/Johannesburg'

        ];

        
        function updateDatalist(inputElement, datalistElement) {
            const value = inputElement.value.toLowerCase();
            const filteredTimeZones = timeZoneNames.filter(zone => zone.toLowerCase().includes(value));
            datalistElement.innerHTML = '';
            filteredTimeZones.forEach(zone => {
                const option = document.createElement('option');
                option.value = zone;
                datalistElement.appendChild(option);
            });
        }

        document.getElementById('cityFrom').addEventListener('input', function() {
            updateDatalist(this, document.getElementById('timezones'));
        });

        document.getElementById('cityTo').addEventListener('input', function() {
            updateDatalist(this, document.getElementById('timezonesTo'));
        });

        async function getCityTimeOffset(timeZone) {
            const apiKey = 'K5V4XLS4KSKE';
            const response = await fetch(`https://api.timezonedb.com/v2.1/get-time-zone?key=${apiKey}&format=json&by=zone&zone=${timeZone}`);
            const data = await response.json();
            if (data.status !== "OK") {
                throw new Error(data.message);
            }
            return data.gmtOffset;
        }

        async function calculateTime() {
            const cityFrom = document.getElementById('cityFrom').value;
            const timeAtCity = document.getElementById('timeAtCity').value;
            const cityTo = document.getElementById('cityTo').value;
            const outputDiv = document.getElementById('output');

            if (!cityFrom || !timeAtCity || !cityTo) {
                outputDiv.textContent = "Please fill in all fields.";
                outputDiv.classList.add('error');
                return;
            }

            try {
                const offsetFrom = await getCityTimeOffset(cityFrom);
                const offsetTo = await getCityTimeOffset(cityTo);

                const [hours, minutes] = timeAtCity.split(':').map(Number);
                const inputDate = new Date();
                inputDate.setUTCHours(hours, minutes, 0, 0);

                const offsetDifference = (offsetTo - offsetFrom) / 3600; // convert seconds to hours
                const targetDate = new Date(inputDate.getTime() + offsetDifference * 3600 * 1000);

                const targetHours = targetDate.getUTCHours().toString().padStart(2, '0');
                const targetMinutes = targetDate.getUTCMinutes().toString().padStart(2, '0');
                outputDiv.textContent = `Time in ${cityTo}: ${targetHours}:${targetMinutes}`;
                outputDiv.classList.remove('error');
            } catch (error) {
                outputDiv.textContent = "Error retrieving time. Please check your time zone names or try again later.";
                outputDiv.classList.add('error');
            }
        }
    </script>

</body>
</html>
